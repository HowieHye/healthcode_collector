<!doctype html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>17ç”µä¿¡1ç­è¡Œç¨‹è½¨è¿¹æ”¶é›†</title>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/HowieHye/StaticFile/healthcode/index.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HowieHye/StaticFile/healthcode/theme.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="all"
    onload="this.media=&quot;all&quot;">
  <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/HowieHye/CDN@latest/blog/favicon.ico">
  <style>
    .avatar-uploader .el-upload {
      border: 1px dashed #d9d9d9;
      border-radius: 6px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .avatar-uploader .el-upload:hover {
      border-color: #409EFF;
    }

    .avatar-uploader-icon {
      font-size: 28px;
      color: #8c939d;
      width: 178px;
      height: 178px;
      line-height: 178px;
      text-align: center;
    }

    .avatar {
      width: 178px;
      height: 178px;
      display: block;
    }

    img {
      width: auto;
      height: auto;
      max-width: 100%;
      max-height: 100%;
    }

    footer {
      text-align: center;
      margin: 20px;
    }

    .copyright:before {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      width: 0.8rem;
      height: 0.8rem;
      border-radius: 0.8rem;
      background: #49b1f5;
      text-align: center;
      content: '';
    }

    .copyright:after {
      position: absolute;
      top: 0.7rem;
      right: 0.7rem;
      width: 0.4rem;
      height: 0.4rem;
      border-radius: 0.4rem;
      background: #ffffff;
      text-align: center;
      content: '';
    }
  </style>
</head>

<body>
  <el-row>
    <el-col id="dialog">
      <el-form :label-position="'left'">
        <el-form-item>
          <h1 style="text-align: center">17ç”µä¿¡1ç­è¡Œç¨‹è½¨è¿¹æ”¶é›†</h1>
        </el-form-item>
        <el-form-term>
          <h3 style="text-align: center">è¯´æ˜ï¼šè¯·å…ˆè¾“å…¥åå­—æˆ–è€…ç‚¹å‡»åå­—ï¼Œç„¶åå†ä¸Šä¼ å›¾ç‰‡ã€‚</h3>
        </el-form-term>
        <el-form-item label="åå­—">
          <el-col :span="18">
            <el-input v-model="name" prop="name" preholder="è¯·è¾“å…¥åå­—"></el-input>
          </el-col>
        </el-form-item>
        <el-form-item label="ä¸Šä¼ ">
          <el-col :span="20">
            <el-button><input type="file" value="" id="file" @change="uploadConfig">
            </el-button>
          </el-col>
          <el-col :span="24">
            <el-divider></el-divider>
          </el-col>
          <el-col :span="8">
            <img v-if="imageUrl" :src="imageUrl" alt="å›¾ç‰‡ä¸Šä¼ å¤±è´¥">
          </el-col>
        </el-form-item>
        <el-form-item label="è¿›åº¦">
          <el-col :span="20">
            <el-progress :percentage="percentage" status="success"></el-progress>
          </el-col>
        </el-form-item>
      </el-form>
      <el-col>
        <el-row :gutter="10">
          <el-col :span="22" :offset="1">
            <h3 style="display: inline-block">è¿˜æœ‰{{ tableData.length }}äººæœªäº¤</h3>
            <a class="site-page" href="/admin">
              <i class="fas fa-user"></i>
              <span>ç®¡ç†</span>
            </a>
          </el-col>
          <el-col>
            <el-divider>ç‚¹å‡»å¡ç‰‡å¯é€‰æ‹©åå­—</el-divider>
          </el-col>
          <el-col v-for="card in tableData" :key="card.forget_name" :span="8">
            <el-card shadow="hover">
              <div @click="assignmentName">
                {{ card.forget_name }}
              </div>
            </el-card>
          </el-col>
        </el-row>
      </el-col>
    </el-col>
  </el-row>
  <footer id="footer">
    <div class="copyright">@2020 By <a href="https://github.com/HowieHye">Howie Hye</a> & <a
        href="https://github.com/Daisy-1999">Daisy-1999</a>
    </div>
    <div class="icp">
      <a target="_blank" rel="noopener external nofollow noreferrer" href="https://beian.miit.gov.cn/"><img
          class="icp-icon" src="/static/images/icp.png" alt="ICP"><span>è‹ICPå¤‡20045438å·-1</span></a>
    </div>
  </footer>
</body>

<script>
  BASE = window.document.location.href;
  vm = new Vue({
    el: '#dialog',
    data: {
      name: '',
      imageUrl: '',
      percentage: 0,
      tableData: []
    },
    computed: {
      // è®¾ç½®è¯·æ±‚å¤´
      headers() {
        return {
          // è®¾ç½®Content-Typeç±»å‹ä¸ºmultipart/form-data
          'ContentType': 'multipart/form-data',
        }
      },
      // è®¾ç½®ä¸Šä¼ åœ°å€
    },
    methods: {
      uploadConfig(e) {
        if (this.name == "") {
          this.$message.error('è¯·å¡«å†™å§“å')
        } else {
          let formData = new FormData();
          let data = JSON.stringify({
            name: this.name
          });
          formData.append('data', data); // ä¸Šä¼ æ–‡ä»¶çš„åŒæ—¶ï¼Œ ä¹Ÿå¯ä»¥ä¸Šä¼ å…¶ä»–æ•°æ®
          formData.append('file', e.target.files[0]);
          let config = {
            headers: {
              'Content-Type': 'multipart/form-data'
            }
          };
          axios.post("upload", formData, config).then(res => {
            if (res.code === 200 || res.code == null || res.code === 0) {
              for (; this.percentage < 100; this.percentage++);
              this.$message({
                message: 'æˆåŠŸä¸Šä¼ ä½ çš„å¥åº·ç ğŸ˜‚å†è§',
                type: 'success'
              });
              this.imageUrl = BASE + res.data;
              this.forget();
              setTimeout(this.refresh, 1000 * 3);
            } else {
              this.$message.error(res.msg || res.message || 'æ–‡ä»¶ä¸Šä¼ å¤±è´¥')
            }
          }).catch((err) => {
            this.$message.error(err.message || 'æ–‡ä»¶ä¸Šä¼ å¤±è´¥')
          })

        }
      },
      forget() {
        var self = this;
        axios.get(BASE + "forget").then(function (response) {
          self.tableData = response.data;
        })
      },
      assignmentName(e) {
        this.name = e.target.innerText;
      },
      refresh() {
        window.location.href = '/';
      }
    },
    mounted: function () {
      this.forget();
    }
  })
</script>

</html>